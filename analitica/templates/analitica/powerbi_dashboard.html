{% extends 'base.html' %}

{% block contenido %}
<div class="contenido contenido-fluid">
    <div class="d-flex justify-content-between align-items-start flex-wrap gap-3 mb-4">
        <div>
            <p class="text-uppercase text-muted small mb-1">Analítica avanzada</p>
            <h2 class="mb-1">Dashboard Power BI</h2>
            <p class="text-muted mb-0">Visualiza el informe mensual con datos actualizados en tiempo real.</p>
        </div>
        <a class="btn btn-outline-secondary" href="{% url 'analitica:dashboard' %}">
            Volver al panel analítico
        </a>
    </div>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
            <div>
                <h5 class="mb-1">Informe integrado</h5>
                <p class="mb-0 text-muted">Mantén sincronizado tu reporte consumiendo la API oficial o exportando el CSV mensual.</p>
            </div>
            <div class="d-flex flex-column flex-sm-row gap-2 w-100 w-sm-auto">
                <a class="btn btn-outline-secondary" href="{{ api_url }}" target="_blank" rel="noopener">
                    API Power BI
                </a>
                <a class="btn btn-background" href="{% url 'analitica:exportar_csv' %}">
                    Exportar CSV
                </a>
            </div>
        </div>
    </div>

    <div class="powerbi-container">
        {% if powerbi_embed_url %}
        <iframe src="{{ powerbi_embed_url }}" title="Dashboard Power BI" frameborder="0" allowfullscreen="true"></iframe>
        {% else %}
        <div class="d-flex flex-column justify-content-center align-items-center text-center h-100">
            <p class="text-muted mb-1">Aún no se ha configurado la URL del informe.</p>
            <small class="text-muted">Define la variable de entorno <code>POWERBI_DASHBOARD_EMBED_URL</code> para visualizar el panel.</small>
        </div>
        {% endif %}
    </div>
</div>
{% endblock contenido %}

{% block extra_scripts %}
{{ block.super }}
<style>
    .powerbi-container {
        width: 100%;
        min-height: 75vh;
        height: calc(100vh - 280px);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.08);
        background: #0f172a;
    }

    .powerbi-container iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
</style>
{% endblock extra_scripts %}
